<!DOCTYPE html>
<html>
<head>
  <title>Valid RSS Feeds</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="p-4">
  <div class="container">
    <h2 class="mb-4">✅ Valid RSS Feeds</h2>
    
    {% if valid_feeds %}
      <ul class="list-group">
        {% for feed in valid_feeds %}
        <li class="list-group-item">
          <a href="{{ feed }}" target="_blank">{{ feed }}</a>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-warning mt-3">
        🚫 No valid RSS feeds found.
      </div>
    {% endif %}

    {% if log %}
    <h4 class="mt-5">📝 Validation Log</h4>
    <ul class="list-group mt-2">
      {% for line in log %}
      <li class="list-group-item">{{ line }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    {% if updates %}
        <h4 class="mt-5">📢 Updates Found</h4>
        {% if updates|length > 0 %}
            <ul class="list-group mt-2">
            {% for site, count in updates.items() %}
            <li class="list-group-item">
                {{ count }} new article{{ 's' if count > 1 else '' }} from <strong>{{ site }}</strong>
            </li>
            {% endfor %}
            </ul>
        {% else %}
            <div class="alert alert-info">📭 No updates found — no new articles were fetched.</div>
        {% endif %}
    {% endif %}

    {% if entries %}
    <h4 class="mt-5">📰 Collected News Entries</h4>
    <ul class="list-group mt-2" id="entryList">
      {% for entry in entries %}
      <li class="list-group-item entry-item" style="display: none;">
        <strong>{{ entry.title }}</strong><br>
        <a href="{{ entry.link }}" target="_blank">Read more</a><br>
        <small>{{ entry.published }} — {{ entry.source }}</small>
      </li>
      {% endfor %}
    </ul>

    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination" id="pagination"></ul>
    </nav>

    <script>
      const itemsPerPage = 10;
      const items = document.querySelectorAll('.entry-item');
      const pagination = document.getElementById('pagination');
      let currentPage = 1;

      function showPage(page) {
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        items.forEach((item, index) => {
          item.style.display = index >= start && index < end ? 'block' : 'none';
        });
      }

      function setupPagination() {
        const pageCount = Math.ceil(items.length / itemsPerPage);
        pagination.innerHTML = '';

        for (let i = 1; i <= pageCount; i++) {
          const li = document.createElement('li');
          li.classList.add('page-item');
          li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
          li.addEventListener('click', function (e) {
            e.preventDefault();
            currentPage = i;
            showPage(currentPage);
            document.querySelectorAll('.page-item').forEach(p => p.classList.remove('active'));
            li.classList.add('active');
          });
          pagination.appendChild(li);
        }

        // Set first page as active
        if (pagination.firstChild) {
          pagination.firstChild.classList.add('active');
        }

        showPage(currentPage);
      }

      window.onload = setupPagination;
    </script>
    {% endif %}

    <a href="/" class="btn btn-secondary mt-4">🔙 Try Again</a>
  </div>
</body>
</html>
